# Simplified API Guide

## üéØ **Simplified Frontend Request**

The frontend now only needs to send minimal data:

```typescript
interface SimplifiedOrderRequest {
  type: "album" | "collage";
  images: string[]; // Base64 encoded images
  customerEmail: string;
  phone: string;
  totalPrice: number;
  address: string;
  city: string;
  postalCode: string;
  name?: string; // Optional - will extract from email if not provided
}
```

## üîß **What Backend Generates Automatically**

### **1. UUID Generation**

- **Field**: `id`
- **Generated by**: DynamoDB automatically creates unique UUIDs
- **Example**: `"123e4567-e89b-12d3-a456-426614174000"`

### **2. Timestamps**

- **Fields**: `createdAt`, `updatedAt`
- **Generated by**: AWS AppSync automatically sets current timestamps
- **Format**: ISO 8601 datetime strings

### **3. User Details**

- **Field**: `userDetails` (AWSJSON)
- **Generated by**: Backend Lambda function
- **Logic**:
  - Uses provided name or extracts from email address
  - Uses provided phone number, address, city, postal code
  - Sets special instructions as "Provided by customer"

### **4. Metadata**

- **Field**: `metadata` (AWSJSON)
- **Generated by**: Backend Lambda function
- **Logic**: Based on order type and image count

### **5. System Fields**

- **Fields**: `status`, `currency`, `imageCount`
- **Generated by**: Backend Lambda function
- **Values**:
  - `status`: Always starts as "PENDING"
  - `currency`: Always "USD"
  - `imageCount`: Calculated from images array length

## üìä **Generated User Details Example**

```json
{
  "userDetails": {
    "name": "John Doe", // From frontend or extracted from email
    "email": "john.doe@example.com", // From frontend
    "phone": "+1234567890", // From frontend
    "address": "123 Main Street", // From frontend
    "city": "New York", // From frontend
    "postalCode": "10001", // From frontend
    "specialInstructions": "Provided by customer"
  }
}
```

## üìã **Generated Metadata Examples**

### **Album Metadata**

```json
{
  "metadata": {
    "orientation": "portrait",
    "pageCount": 10, // Math.ceil(imageCount / 2)
    "dimensions": {
      "width": 8,
      "height": 10
    },
    "paperType": "glossy",
    "binding": "spiral"
  }
}
```

### **Collage Metadata**

```json
{
  "metadata": {
    "template": "grid-2x2", // Based on image count
    "background": "white",
    "spacing": 10,
    "borderRadius": 5,
    "outputFormat": "high-res"
  }
}
```

## üß™ **Test the Simplified API**

### **Run the Test Script**

```bash
./test-simplified-order.sh
```

### **Manual cURL Test**

```bash
curl --location 'https://n243frnyuncvnnzw3tjcngpwh4.appsync-api.us-east-1.amazonaws.com/graphql' \
--header 'Content-Type: application/json' \
--header 'x-api-key: da2-e7jnjxawkzedlf4xeimfisrgvq' \
--data-raw '{
  "query": "mutation CreateOrderCustom($input: JSON!) { createOrderCustom(input: $input) }",
  "variables": {
    "input": {
      "type": "album",
      "images": ["data:image/jpeg;base64,/9j/4AAQ..."],
      "customerEmail": "john.doe@example.com",
      "phone": "+1234567890",
      "totalPrice": 25.00,
      "address": "123 Main Street",
      "city": "New York",
      "postalCode": "10001",
      "name": "John Doe"
    }
  }
}'
```

## üì± **Frontend Integration**

### **React Example**

```typescript
const createOrder = async (orderData: SimplifiedOrderRequest) => {
  const response = await fetch(
    "https://n243frnyuncvnnzw3tjcngpwh4.appsync-api.us-east-1.amazonaws.com/graphql",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": "da2-e7jnjxawkzedlf4xeimfisrgvq",
      },
      body: JSON.stringify({
        query: `
        mutation CreateOrderCustom($input: JSON!) {
          createOrderCustom(input: $input)
        }
      `,
        variables: {
          input: orderData,
        },
      }),
    }
  );

  return response.json();
};

// Usage
const orderData = {
  type: "album",
  images: ["data:image/jpeg;base64,..."],
  customerEmail: "user@example.com",
  phone: "+1234567890",
  totalPrice: 25.0,
  address: "123 Main Street",
  city: "New York",
  postalCode: "10001",
  name: "John Doe",
};

const result = await createOrder(orderData);
```

## üîÑ **Response Format**

```json
{
  "statusCode": 201,
  "body": {
    "orderId": "123e4567-e89b-12d3-a456-426614174000",
    "type": "album",
    "status": "PENDING",
    "totalPrice": 25.0,
    "currency": "USD",
    "imageCount": 1,
    "customerEmail": "john.doe@example.com",
    "userDetails": {
      "name": "John Doe",
      "email": "john.doe@example.com",
      "phone": "+1234567890",
      "address": "123 Main Street",
      "city": "New York",
      "postalCode": "10001",
      "specialInstructions": "Provided by customer"
    },
    "metadata": {
      "orientation": "portrait",
      "pageCount": 1,
      "dimensions": { "width": 8, "height": 10 },
      "paperType": "glossy",
      "binding": "spiral"
    },
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-15T10:30:00.000Z"
  }
}
```

## üöÄ **Benefits**

1. **Simplified Frontend**: Only 5 fields needed from frontend
2. **Backend Intelligence**: Automatic generation of complex data
3. **Consistent Data**: Standardized metadata and user details
4. **Reduced Errors**: Less chance of frontend validation issues
5. **Easy Enhancement**: Backend can be enhanced with external APIs

## üîß **Future Enhancements**

### **User Details Enhancement**

- Integrate with address lookup APIs
- Connect to customer database
- Add phone number validation

### **Metadata Enhancement**

- Dynamic pricing based on image analysis
- Smart template selection
- Quality optimization based on image properties

### **Validation Enhancement**

- Image format validation
- File size limits
- Content moderation

## üìù **Migration Guide**

### **From Complex to Simple**

1. **Remove from frontend**:
   - `id` (let backend generate)
   - `userDetails` object (let backend generate)
   - `metadata` object (let backend generate)
   - `createdAt`, `updatedAt` (let backend generate)
   - `status`, `currency`, `imageCount` (let backend generate)

2. **Keep in frontend**:
   - `type`
   - `images` (Base64 array)
   - `customerEmail`
   - `phone`
   - `totalPrice`
   - `address`
   - `city`
   - `postalCode`
   - `name` (optional)

3. **Update validation**:
   - Remove complex validation logic
   - Keep basic field validation
   - Let backend handle business logic

This simplified approach makes the frontend much cleaner while maintaining all functionality through intelligent backend processing! üéâ
